<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Jobs - SmartHire</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-briefcase"></i>
            <span>SmartHire</span>
        </div>
        <ul class="nav-links">
            <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
            <li><a href="jobs.html"><i class="fas fa-briefcase"></i> Find Jobs</a></li>
            <li><a href="php/logout.php"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
        <div class="hamburger">
            <i class="fas fa-bars"></i>
        </div>
    </nav>

    <div class="container">
        <div class="card">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h1><i class="fas fa-search"></i> Recommended Jobs for You</h1>
                <p style="color: #6b7280; font-size: 1.1rem;">Jobs are ranked by how well they match your skills and preferences</p>
            </div>
            
            <!-- Filter Buttons -->
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; justify-content: center;">
                <button class="btn btn-primary" onclick="filterJobs('all')" id="filterAll">
                    <i class="fas fa-th"></i> All Jobs
                </button>
                <button class="btn" style="background: #10b981; color: white;" onclick="filterJobs('high')" id="filterHigh">
                    <i class="fas fa-fire"></i> High Match (70%+)
                </button>
                <button class="btn" style="background: #f59e0b; color: white;" onclick="filterJobs('medium')" id="filterMedium">
                    <i class="fas fa-star"></i> Medium Match (40-70%)
                </button>
                <button class="btn" style="background: #6b7280; color: white;" onclick="filterJobs('low')" id="filterLow">
                    <i class="fas fa-info-circle"></i> Low Match (<40%)
                </button>
            </div>

            <!-- Jobs Grid -->
            <div id="jobsGrid" class="jobs-container">
                <div style="text-align: center; padding: 3rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #667eea;"></i>
                    <p style="margin-top: 1rem; color: #6b7280; font-size: 1.1rem;">Finding perfect jobs for you...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot Widget -->
    <div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <button onclick="toggleChatbot()" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4); transition: all 0.3s;" id="chatbotBtn">
            <i class="fas fa-comments"></i>
        </button>
        
        <div id="chatbotWindow" style="display: none; position: absolute; bottom: 80px; right: 0; width: 350px; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden;">
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div style="font-weight: 600; font-size: 1.1rem;">Career Assistant</div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">Ask me anything!</div>
                </div>
                <button onclick="toggleChatbot()" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="chatMessages" style="height: 300px; overflow-y: auto; padding: 1rem; background: #f9fafb;">
                <div style="background: white; padding: 0.75rem; border-radius: 10px; margin-bottom: 0.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                    <i class="fas fa-robot" style="color: #667eea;"></i> Hi! I'm your career assistant. Ask me about resume tips, job search strategies, or career advice!
                </div>
            </div>
            <div style="padding: 1rem; border-top: 1px solid #e5e7eb; background: white;">
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" id="chatInput" placeholder="Type your question..." style="flex: 1; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 25px; outline: none;">
                    <button onclick="sendMessage()" style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; cursor: pointer;">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        let allJobs = [];
        let currentFilter = 'all';

        async function loadJobs() {
            try {
                const response = await fetch('php/get_jobs.php');
                const data = await response.json();
                
                if (data.success) {
                    allJobs = data.jobs;
                    displayJobs(allJobs);
                } else {
                    window.location.href = 'login.html';
                }
            } catch (error) {
                document.getElementById('jobsGrid').innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ef4444;"></i>
                        <p style="margin-top: 1rem; color: #ef4444;">Failed to load jobs. Please try again.</p>
                    </div>
                `;
            }
        }

        function displayJobs(jobs) {
            const grid = document.getElementById('jobsGrid');
            
            if (jobs.length === 0) {
                grid.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-search" style="font-size: 3rem; color: #6b7280;"></i>
                        <p style="margin-top: 1rem; color: #6b7280; font-size: 1.1rem;">No jobs found matching your criteria.</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = jobs.map((job, index) => {
                const matchColor = job.match_percentage >= 70 ? '#10b981' : 
                                   job.match_percentage >= 40 ? '#f59e0b' : '#6b7280';
                const matchIcon = job.match_percentage >= 70 ? 'fa-fire' :
                                 job.match_percentage >= 40 ? 'fa-star' : 'fa-info-circle';
                
                return `
                    <div class="job-card" style="animation: fadeInUp 0.5s ease ${index * 0.1}s both;">
                        <div class="job-header">
                            <div>
                                <h3><i class="fas fa-briefcase" style="color: ${matchColor};"></i> ${job.title}</h3>
                                <p><i class="fas fa-building"></i> ${job.company}</p>
                                <p><i class="fas fa-map-marker-alt"></i> ${job.location}</p>
                            </div>
                            <div class="match-badge" style="background: ${matchColor};">
                                <i class="fas ${matchIcon}"></i> ${job.match_percentage}%
                            </div>
                        </div>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${job.match_percentage}%;"></div>
                        </div>
                        
                        <p style="margin: 1rem 0; color: #4b5563;">${job.description.substring(0, 150)}...</p>
                        
                        <div style="margin: 1rem 0;">
                            <strong style="color: #10b981;"><i class="fas fa-money-bill-wave"></i> ${job.salary}</strong>
                        </div>
                        
                        <div class="skills-container">
                            ${job.required_skills.map(skill => {
                                const isMatched = job.matched_skills.includes(skill.toLowerCase().trim());
                                return `<span class="skill-tag ${isMatched ? 'matched' : ''}">${isMatched ? '<i class="fas fa-check"></i> ' : ''}${skill}</span>`;
                            }).join('')}
                        </div>
                        
                        <div style="margin-top: 1.5rem; display: flex; gap: 0.75rem;">
                            <button onclick="applyJob(${job.id}, ${job.match_percentage}, '${job.title}')" class="btn btn-primary" style="flex: 1;">
                                <i class="fas fa-paper-plane"></i> Apply Now
                            </button>
                            <button onclick="viewDetails(${JSON.stringify(job).replace(/"/g, '&quot;')})" class="btn" style="background: #f3f4f6; color: #1f2937;">
                                <i class="fas fa-info-circle"></i> Details
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterJobs(type) {
            currentFilter = type;
            
            // Update button styles
            ['filterAll', 'filterHigh', 'filterMedium', 'filterLow'].forEach(id => {
                const btn = document.getElementById(id);
                btn.style.opacity = '0.6';
                btn.style.transform = 'scale(0.95)';
            });
            
            const activeBtn = document.getElementById('filter' + type.charAt(0).toUpperCase() + type.slice(1));
            activeBtn.style.opacity = '1';
            activeBtn.style.transform = 'scale(1)';
            
            let filteredJobs = allJobs;
            
            if (type === 'high') {
                filteredJobs = allJobs.filter(job => job.match_percentage >= 70);
            } else if (type === 'medium') {
                filteredJobs = allJobs.filter(job => job.match_percentage >= 40 && job.match_percentage < 70);
            } else if (type === 'low') {
                filteredJobs = allJobs.filter(job => job.match_percentage < 40);
            }
            
            displayJobs(filteredJobs);
        }

        async function applyJob(jobId, matchPercentage, jobTitle) {
            if (!confirm(`Apply for "${jobTitle}"?`)) return;
            
            const formData = new FormData();
            formData.append('job_id', jobId);
            formData.append('match_percentage', matchPercentage);
            
            try {
                const response = await fetch('php/apply_job.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                showNotification(data.message, data.success ? 'success' : 'error');
            } catch (error) {
                showNotification('Application failed. Please try again.', 'error');
            }
        }

        function viewDetails(job) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem;">
                        <div>
                            <h2 style="margin-bottom: 0.5rem;">${job.title}</h2>
                            <p style="color: #6b7280;"><i class="fas fa-building"></i> ${job.company}</p>
                        </div>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div style="background: linear-gradient(135deg, ${job.match_percentage >= 70 ? '#10b981' : job.match_percentage >= 40 ? '#f59e0b' : '#6b7280'}, transparent); padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                        <div style="font-size: 2rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">${job.match_percentage}% Match</div>
                        <div style="color: white; opacity: 0.9;">This job matches your profile</div>
                    </div>
                    <p><strong><i class="fas fa-map-marker-alt"></i> Location:</strong> ${job.location}</p>
                    <p><strong><i class="fas fa-money-bill-wave"></i> Salary:</strong> ${job.salary}</p>
                    <p><strong><i class="fas fa-info-circle"></i> Description:</strong></p>
                    <p style="color: #6b7280; line-height: 1.6;">${job.description}</p>
                    <p><strong><i class="fas fa-code"></i> Required Skills:</strong></p>
                    <div class="skills-container">
                        ${job.required_skills.map(skill => {
                            const isMatched = job.matched_skills.includes(skill.toLowerCase().trim());
                            return `<span class="skill-tag ${isMatched ? 'matched' : ''}">${isMatched ? '<i class="fas fa-check"></i> ' : ''}${skill}</span>`;
                        }).join('')}
                    </div>
                    <button onclick="applyJob(${job.id}, ${job.match_percentage}, '${job.title.replace(/'/g, "\\'")}'); this.closest('.modal').remove();" class="btn btn-primary btn-block" style="margin-top: 1.5rem;">
                        <i class="fas fa-paper-plane"></i> Apply Now
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Chatbot functionality
        function toggleChatbot() {
            const chatWindow = document.getElementById('chatbotWindow');
            const btn = document.getElementById('chatbotBtn');
            
            if (chatWindow.style.display === 'none') {
                chatWindow.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-times"></i>';
            } else {
                chatWindow.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-comments"></i>';
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, true);
            input.value = '';
            
            // Simulate bot response
            setTimeout(() => {
                const response = getBotResponse(message);
                addChatMessage(response, false);
            }, 500);
        }

        function addChatMessage(message, isUser) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                background: ${isUser ? 'linear-gradient(135deg, #667eea, #764ba2)' : 'white'};
                color: ${isUser ? 'white' : '#1f2937'};
                padding: 0.75rem;
                border-radius: 10px;
                margin-bottom: 0.5rem;
                margin-left: ${isUser ? 'auto' : '0'};
                margin-right: ${isUser ? '0' : 'auto'};
                max-width: 80%;
                box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            `;
            messageDiv.innerHTML = isUser ? message : `<i class="fas fa-robot" style="color: #667eea;"></i> ${message}`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function getBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('resume') || lowerMessage.includes('cv')) {
                return 'Keep your resume concise (1-2 pages), use action verbs, and quantify your achievements. Tailor it for each job!';
            } else if (lowerMessage.includes('interview')) {
                return 'Prepare using the STAR method (Situation, Task, Action, Result). Research the company and prepare thoughtful questions!';
            } else if (lowerMessage.includes('skill')) {
                return 'Focus on both technical and soft skills. List programming languages, frameworks, and tools you know. Don\'t forget communication and teamwork!';
            } else if (lowerMessage.includes('salary') || lowerMessage.includes('negotiate')) {
                return 'Research market rates for your role and location. Know your worth and be prepared to negotiate professionally. Consider total compensation!';
            } else if (lowerMessage.includes('apply')) {
                return 'Apply to jobs with 60%+ match for better chances. Customize your application for each job and follow up after applying!';
            } else if (lowerMessage.includes('help') || lowerMessage.includes('hi') || lowerMessage.includes('hello')) {
                return 'I can help with resume tips, interview prep, job search strategies, salary negotiation, and career advice. What would you like to know?';
            } else {
                return 'That\'s a great question! I can help with resumes, interviews, job search tips, and career advice. What specific topic interests you?';
            }
        }

        // Enable enter key for chat
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Initialize
        loadJobs();
    </script>
</body>
</html>